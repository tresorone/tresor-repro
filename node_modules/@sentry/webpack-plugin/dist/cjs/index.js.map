{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import {\n  getDebugIdSnippet,\n  Options,\n  sentryUnpluginFactory,\n  stringToUUID,\n  SentrySDKBuildFlags,\n  createComponentNameAnnotateHooks,\n} from \"@sentry/bundler-plugin-core\";\nimport * as path from \"path\";\nimport { UnpluginOptions } from \"unplugin\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore webpack is a peer dep\nimport * as webback4or5 from \"webpack\";\n\ninterface BannerPluginCallbackArg {\n  chunk?: {\n    hash?: string;\n  };\n}\n\nfunction webpackReleaseInjectionPlugin(injectionCode: string): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-release-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: injectionCode,\n        })\n      );\n    },\n  };\n}\n\nfunction webpackComponentNameAnnotatePlugin(): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-component-name-annotate-plugin\",\n    enforce: \"pre\",\n    // Webpack needs this hook for loader logic, so the plugin is not run on unsupported file types\n    transformInclude(id) {\n      return id.endsWith(\".tsx\") || id.endsWith(\".jsx\");\n    },\n    transform: createComponentNameAnnotateHooks().transform,\n  };\n}\n\nfunction webpackBundleSizeOptimizationsPlugin(\n  replacementValues: SentrySDKBuildFlags\n): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-bundle-size-optimizations-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const DefinePlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.DefinePlugin ||\n        webback4or5?.DefinePlugin ||\n        webback4or5?.default?.DefinePlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new DefinePlugin({\n          ...replacementValues,\n        })\n      );\n    },\n  };\n}\n\nfunction webpackDebugIdInjectionPlugin(): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-debug-id-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: (arg?: BannerPluginCallbackArg) => {\n            const debugId = arg?.chunk?.hash ? stringToUUID(arg.chunk.hash) : uuidv4();\n            return getDebugIdSnippet(debugId);\n          },\n        })\n      );\n    },\n  };\n}\n\nfunction webpackDebugIdUploadPlugin(\n  upload: (buildArtifacts: string[]) => Promise<void>\n): UnpluginOptions {\n  const pluginName = \"sentry-webpack-debug-id-upload-plugin\";\n  return {\n    name: pluginName,\n    webpack(compiler) {\n      compiler.hooks.afterEmit.tapAsync(pluginName, (compilation, callback: () => void) => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const outputPath = (compilation.outputOptions.path as string | undefined) ?? path.resolve();\n        const buildArtifacts = Object.keys(compilation.assets as Record<string, unknown>).map(\n          (asset) => path.join(outputPath, asset)\n        );\n        void upload(buildArtifacts).then(() => {\n          callback();\n        });\n      });\n    },\n  };\n}\n\nfunction webpackModuleMetadataInjectionPlugin(injectionCode: string): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-module-metadata-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: injectionCode,\n        })\n      );\n    },\n  };\n}\n\nconst sentryUnplugin = sentryUnpluginFactory({\n  releaseInjectionPlugin: webpackReleaseInjectionPlugin,\n  componentNameAnnotatePlugin: webpackComponentNameAnnotatePlugin,\n  moduleMetadataInjectionPlugin: webpackModuleMetadataInjectionPlugin,\n  debugIdInjectionPlugin: webpackDebugIdInjectionPlugin,\n  debugIdUploadPlugin: webpackDebugIdUploadPlugin,\n  bundleSizeOptimizationsPlugin: webpackBundleSizeOptimizationsPlugin,\n});\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const sentryWebpackPlugin: (options?: Options) => any = sentryUnplugin.webpack;\n\nexport { sentryCliBinaryExists } from \"@sentry/bundler-plugin-core\";\nexport type { Options as SentryWebpackPluginOptions } from \"@sentry/bundler-plugin-core\";\n"],"names":["webpackReleaseInjectionPlugin","injectionCode","name","webpack","compiler","_compiler$webpack","_webback4or5$default","BannerPlugin","webback4or5","options","plugins","push","raw","include","banner","webpackComponentNameAnnotatePlugin","enforce","transformInclude","id","endsWith","transform","createComponentNameAnnotateHooks","webpackBundleSizeOptimizationsPlugin","replacementValues","_compiler$webpack2","_webback4or5$default2","DefinePlugin","_objectSpread","webpackDebugIdInjectionPlugin","_compiler$webpack3","_webback4or5$default3","arg","_arg$chunk","debugId","chunk","hash","stringToUUID","uuidv4","getDebugIdSnippet","webpackDebugIdUploadPlugin","upload","pluginName","hooks","afterEmit","tapAsync","compilation","callback","_ref","outputPath","outputOptions","path","resolve","buildArtifacts","Object","keys","assets","map","asset","join","then","webpackModuleMetadataInjectionPlugin","_compiler$webpack4","_webback4or5$default4","sentryUnplugin","sentryUnpluginFactory","releaseInjectionPlugin","componentNameAnnotatePlugin","moduleMetadataInjectionPlugin","debugIdInjectionPlugin","debugIdUploadPlugin","bundleSizeOptimizationsPlugin","sentryWebpackPlugin"],"mappings":"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"}